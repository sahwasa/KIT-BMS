@@include('../../inc/layout/top.html')
<div id="wrap" class="wrap">
  @@include('../../inc/layout/header.html')
  @@include('../../inc/layout/nav.html')
  <main id="content" class="container">
    @@include('../../inc/snb/board.html')
    <section class="contents">
      @@include('../../inc/snb/snb_fold.html')
      <header class="cont_tit">
        <h1>사진첩<span>게시판</span></h1>
        <section class="bredcrumb">
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">게시판</a></li>
            <li>사진첩</li>
          </ul>
        </section>
      </header>
      <div class="cont_body">
        <article class="box_compact box_tool">
          <a href="board_photo.html" class="btn_gray_line">목록</a>
          <span class="floatR btn_wrap" id="selMode_off" data-tglwrap>
            <div class="btn_file_wrap">
              <input id="attachFiles" type="file" data-attach="doc" name="file" title="파일첨부하기" class="btn_file" multiple>
              <button type="button" class="btn_red">사진추가</button>
            </div>
            <button type="button" class="btn_gray_line" data-toggle="selMode_on" data-clickEvt="selMode_on">선택</button>
            <button type="button" class="btn_gray_line">앨범삭제</button>
          </span>
          <div class="floatR btn_wrap" id="selMode_on" data-tglwrap>
            <p><strong id="sel_count" class="t_red">0</strong>장의 사진이 선택되었습니다.</p>
            <button type="button" class="btn_red_line" data-clickEvt="sel_release">선택해제</button>
            <button type="button" class="btn_red">다운로드</button>
@@include('../../inc/pop/p_moveGroup.html')
            <button type="button" class="btn_red_line" onclick="document.querySelector('.p_moveAlbum').showModal();">이동?</button>
            <button type="button" class="btn_red_line">삭제</button>
            <button type="button" class="btn_gray_line" data-toggle="selMode_off" data-clickEvt="selMode_off">나가기</button>
          </div>
        </article>
        <div class="post_wrap">
          <section class="post">
            <article class="box_default_w">
              <div class="tit">
                <h1>2024년 시무식<em class="count">12</em></h1>
              </div>
              <div class="album_view">
                <ul class="attach_list album_lst">
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#" id="photo01">
                      <img src="https://picsum.photos/1200/1500?random=1">
                      1</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/500/200?random=2">
                      2</a>
                  </li>               
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=3">
                      3</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=4">
                      4</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=5">
                      나는 2023년 6월 30일 금요일에 작성된 어딘가 모르게 겁나긴 제목의 첨부파일.pptx</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=6">
                      첨부파일 문서2.jpeg</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=7">
                      나는 2023년 6월 30일 금요일에 작성된 어딘가 모르게 겁나긴 제목의 첨부파일.pptx</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=8">
                      첨부파일 문서2.jpeg</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=9">
                      나는 2023년 6월 30일 금요일에 작성된 어딘가 모르게 겁나긴 제목의 첨부파일.pptx</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=10">
                      첨부파일 문서2.jpeg</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=11">
                      나는 2023년 6월 30일 금요일에 작성된 어딘가 모르게 겁나긴 제목의 첨부파일.pptx</a>
                  </li>
                  <li>
                    <input type="checkbox" class="check_circle">
                    <a href="#">
                      <img src="https://picsum.photos/200/300?random=12">
                      첨부파일 문서2.jpeg</a>
                  </li>
                </ul>
              </div>
            </article>
          </section>
        </div>
      </div>
    </section>
  </main>
  @@include('../../inc/layout/footer.html')
</div>
@@include('../../inc/pop/p_moveAlbum.html')
@@include('../../inc/layout/script.html')
<script>
  $(function () {
    const list = $('.album_lst');
    $("[data-clickEvt]").on('click',function(e){
      var evt = e.target.dataset.clickevt;
      console.log(e.target.dataset)
      switch (evt) {
        case 'selMode_on':
           list.addClass('select_mode');          
          break;
        case 'selMode_off':
          list.find(':checkbox').prop('checked', false);
          list.removeClass('select_mode');                    
          break;
        default:
          list.find(':checkbox').prop('checked', false);
          break;
      }
      $('#sel_count').text('0');
    })
    list.off('click').on('click','a',function(){
        var source = $(this).children('img').attr('src');
        var caption = $(this).text();
        if($('#photoWrap').length === 0){
          var photoWrap = document.createElement('dialog')
              photoWrap.id = 'photoWrap'
              photoWrap.classList.add('photo_wrap');
              photoWrap.innerHTML = `
              <div class="flex_wrapper">
                <section class="photo_dtl">
                  <header class="p_header">
                    <div class="pageView">
                      <strong></strong>
                      <span class="total"></span>
                    </div>
                    <div class="tool">
                      <a href="" download class="btn btn_download" title="다운로드">다운로드</a>
                      <button class="btn btn_del" title="삭제">삭제</button>
                      <button class="btn btnClose cancel" title="닫기">닫기</button>
                    </div>
                  </header>
                  <div class="p_body">
                    <div class="viewer">                  
                      <figure class="photo_view">
                        <img id="photo" />
                        <figcaption></figcaption>
                      </figure>
                      <div class="remote">
                        <button class="btn_prev" type="button" title="이전">이전</button>
                        <button class="btn_next" type="button" title="다음">다음</button>                      
                      </div>
                    </div>
                  </div>
                </section>
                <aside>
                  <div class="post_writer">
                    <div class="user_module">
                      <figure class="user_photo"><img src="../../images/ic_user.png" alt="" loading="lazy"></figure> 
                      <strong>
                        <em>홍OO 연구원</em><b>(재난예경보MA팀)</b>                      
                        <div class="date">2023-05-01 12:34:54</div>
                      </strong>
                    </div>
                  </div>
                  <section class="cmt_area">                    
                    <ul class="cmt_lst">
                      <li>
                        <div class="cmt_user">
                          @@include('../../inc/module/module_user.html')
                        </div>
                        <div class="cmt_txt">
                          <p>반려합니다.</p>
                        </div>
                        <div class="cmt_info">
                          <span class="date">2023-05-23 11:35</span>
                          <button type="button">답글</button>
                        </div>
                        <div class="reply_area">
                          <ul>
                            <li>
                              <div class="cmt_user">
                                @@include('../../inc/module/module_user.html')
                              </div>
                              <div class="cmt_txt">
                                <p>왜요?</p>
                              </div>
                              <div class="cmt_info">
                                <span class="date">2023-05-23 11:35</span>
                                <button type="button">답글</button>
                              </div>
                            </li>
                            <li>
                              <div class="cmt_user">
                                @@include('../../inc/module/module_user.html')
                              </div>
                              <div class="cmt_txt">
                                <textarea name="" id="" cols="30" rows="2" title="답글" placeholder="홍길동님에게 답글쓰기"></textarea>
                              </div>
                              <div class="cmt_attach">
                                <button type="button">등록</button>
                              </div>            
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li>
                        <div class="cmt_user">
                          @@include('../../inc/module/module_user.html')
                          <div class="layer_tool">
                            <button type="button" class="btn_ellipsis" title="더보기">더보기</button>
                            <div class="btn_layer">
                              <button type="button" data-clickevt="modify">수정</button>
                              <button type="button" data-clickevt="del">삭제</button>
                            </div>
                          </div>
                        </div>
                        <div class="cmt_txt">
                          <p>
                            이 댓글은 로그인한 사람이 작성한 글입니다.<br>
                            따라서 우측 상단에 수정과 삭제 버튼을 추가했습니다.<br>
                            댓글이 없을 때는 아래와 같이 보여줍니다.  
                          </p>
                        </div>
                        <div class="cmt_info">
                          <span class="date">2023-05-23 11:35</span>
                          <button type="button">답글</button>
                        </div>
                      </li>
                      <li>
                        작성된 댓글이 없습니다.
                      </li>
                    </ul>
                    <div class="cmt_write" id="cmt_write">
                      <div class="user_module">
                        <figure class="user_photo"><img src="../images/ic_user.png" alt="" loading="lazy"></figure>
                        <em>반미선 책임</em><b>(컨텐츠팀)</b>
                      </div>
                      <div id="reply_input" class="editable" placeholder="댓글을 입력하세요" contenteditable="true" data-tribute="true"></div>
                      <div class="cmt_attach">
                        <div class="file_attach btn_attach">
                          <input id="attachFiles" type="file" data-attach="cmt" name="file" title="파일첨부하기" class="btn_file" multiple="">
                          <div id="file-drop" class="drop_zone">
                            <ul id="cmt" class="attach_list"></ul>
                          </div>
                        </div>
                        <label for="attachFiles" class="btn_label_attach">첨부</label>
                        <button type="button" onclick="submitReply(this)">등록</button>
                      </div>
                    </div>    
                  </section>
                </aside>
              </div>
            `
          var viewWrap = document.getElementById('wrap');
          viewWrap.insertAdjacentElement('afterend', photoWrap);
        };
        var index = $(this).closest('li').index();
        var max = $(this).parents('.album_lst').find('li').length;
        setPhotoView(source,caption,index,max);

    })
    .on('change',':checkbox',function(){
      if(!(list.hasClass('select_mode'))) $('[data-toggle="selMode_on"]').trigger('click');
      $('#sel_count').text(list.find(':checked').length);
    });
    function setPhotoView(source,caption,index,max){
      const photoWrap = document.getElementById('photoWrap');
      $(photoWrap).find('#photo').attr('src',source).next('figcaption').text(caption);
      $(photoWrap).find('.btn_download').attr('href',source);
      $('.total').text(max);
      $('.total').prev('strong').text(index + 1);
      (index <= 0) ? $('.btn_prev').hide():$('.btn_prev').show();
      (index >= max - 1) ? $('.btn_next').hide():$('.btn_next').show();
      photoWrap.showModal();
      $('.cancel').on('click',function(){
        photoWrap.close();
      });
      $('.btn_next').off('click').on('click',function(){
        index = index + 1;
        remoteShow(index);
      })
      $('.btn_prev').off('click').on('click',function(){
        index = index - 1;
        remoteShow(index);
      })
    }
    function remoteShow(index){
      var target = $('.album_lst').children('li').eq(index);
      source = target.find('img').attr('src');
      caption = target.text();
      setPhotoView(source,caption,index)
    }

  })
</script>

</body>

</html>